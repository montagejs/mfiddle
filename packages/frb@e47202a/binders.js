function getStackTrace(){return Error("").stack.replace(/^.*\n.*\n/,"\n")}function bindProperty(t,e,n,i,a,r){return n(autoCancelPrevious(function(n){if(!a.isActive)try{a.isActive=!0,r&&console.log("SET",r.targetPath,"TO",n,"ON",t,"BECAUSE",r.sourcePath,getStackTrace()),Array.isArray(t)&&e>>>0===e?t.set(e,n):t[e]=n}finally{a.isActive=!1}}),i)}function makePropertyBinder(t,e){return function(n,i,a,r,s){return e(autoCancelPrevious(function(e){return null!=e?t(autoCancelPrevious(function(t){return null!=t?t.bindProperty?t.bindProperty(e,n,i,r,s):_bindProperty(t,e,n,i,r,s):void 0}),a):void 0}),a)}}function bindGet(t,e,n,i,a,r){return n(autoCancelPrevious(function(n){if(!a.isActive)try{a.isActive=!0,r&&console.log("SET FOR KEY",e,"TO",n,"ON",t,"BECAUSE",r.sourcePath,getStackTrace()),t.set(e,n)}finally{a.isActive=!1}}),i)}function makeGetBinder(t,e){return function(n,i,a,r,s){return t(autoCancelPrevious(function(t){return t?e(autoCancelPrevious(function(e){return null!=e?_bindGet(t,e,n,i,r,s):void 0}),a):void 0}),a)}}function makeHasBinder(t,e){return function(n,i,a,r,s){return t(autoCancelPrevious(function(t){return t?e(autoCancelPrevious(function(e){return null!=e?n(autoCancelPrevious(function(n){if(n)(t.has||t.contains).call(t,e)||(s&&console.log("ADD",e,"TO",s.targetPath,"BECAUSE",s.sourcePath,getStackTrace()),t.add(e));else for(;(t.has||t.contains).call(t,e);)s&&console.log("REMOVE",e,"FROM",s.targetPath,"BECAUSE",s.sourcePath,getStackTrace()),(t.remove||t["delete"]).call(t,e)}),i):void 0}),a):void 0}),a)}}function makeEqualityBinder(t,e){return function(n,i,a,r,s){return n(autoCancelPrevious(function(n){return n?(s&&console.log("BIND",s.targetPath,"TO",s.sourcePath,getStackTrace()),t(e,i,i,r,s),function(){s&&console.log("UNBIND",s.targetPath,"FROM",s.sourcePath,getStackTrace())}):void 0}),a)}}function makeEveryBlockBinder(t,e,n){return function(i,a,r,s,o){return i(autoCancelPrevious(function(i){return i?t(autoCancelPrevious(function(t){function i(t,i,l){a.swap(l,i.length,t.map(function(t){var i=Scope.nest(r,t);return e(n,i,i,s,o)}))}if(t){var a=[],l=observeRangeChange(t,i,r);return function(){cancelEach(a),l()}}}),r):void 0}),a)}}function makeAndBinder(t,e,n,i,a,r){var s=makeNotObserver(i),o=makeAndObserver(n,s);return function(n,i,s,l,c){return n(autoCancelPrevious(function(n){if(null!=n){if(n){var i=t(a,trueScope,s,l,c),h=e(r,trueScope,s,l,c);return function(){i(),h()}}return t(o,s,s,l,c)}}),i)}}function makeOrBinder(t,e,n,i,a,r){var s=makeNotObserver(i),o=makeOrObserver(n,s);return function(n,i,s,l,c){return n(autoCancelPrevious(function(n){if(null!=n){if(n)return t(o,s,s,l,c);var i=t(a,falseScope,s,l,c),h=e(r,falseScope,s,l,c);return function(){i(),h()}}}),i)}}function makeConditionalBinder(t,e,n){return function(i,a,r,s,o){return t(autoCancelPrevious(function(t){return null!=t?t?e(i,a,r,s,o):n(i,a,r,s,o):void 0}),a)}}function makeOnlyBinder(t){return function(e,n,i){return t(autoCancelPrevious(function(t){return t?e(autoCancelPrevious(function(e){null!=e&&t.splice(0,t.length,e)}),n):void 0}),i)}}function makeRangeContentBinder(t,e){return function(n,i,a,r,s){return t(autoCancelPrevious(function(t){return t?n(autoCancelPrevious(function(e){function n(e,n,i){isActive(t)||(s&&console.log("SWAPPING",n,"FOR",e,"AT",i,"ON",s.targetPath,getStackTrace()),t.swap?t.swap(i,n.length,e):t.add&&(t.remove||t["delete"])&&(e.forEach(t.add,t),n.forEach(t.remove||t["delete"],t)))}if(e!==t){if(!e)return t.clear(),void 0;if(e.addRangeChangeListener)return e.addRangeChangeListener(n),n(Array.from(e),Array.from(t),0),once(function(){e.removeRangeChangeListener(n)})}}),i):e(Observers.makeLiteralObserver([]),i,a,r,s)}),a)}}function makeMapContentBinder(t){return function(e,n,i,a,r){return t(autoCancelPrevious(function(t){return t?e(autoCancelPrevious(function(e){function n(e,n){if(!a.isActive)try{a.isActive=!0,void 0===e?(r&&r&&console.log("DELETED",r.targetPath,"FOR KEY",n,"ON",t,"BECAUSE",r.sourcePath,getStackTrace()),Array.isArray(t)?t.splice(n,1):t["delete"](n)):(r&&r&&console.log("SET",r.targetPath,"FOR KEY",n,"TO",e,"ON",t,"BECAUSE",r.sourcePath,getStackTrace()),t.set(n,e))}finally{a.isActive=!1}}return e?(t.clear(),e.forEach(n),e.addMapChangeListener(n)):(t.clear(),void 0)}),n):void 0}),i)}}function makeReversedBinder(t){return function(e,n,i){return t(autoCancelPrevious(function(t){return t?e(autoCancelPrevious(function(e){function n(e,n,i){if(!isActive(t)){var a=t.length-i-n.length;t.swap(a,n.length,e.reversed())}}return e?(e.addRangeChangeListener(n),n(e,t,0),once(function(){e.removeRangeChangeListener(n)})):(t.clear(),void 0)}),n):void 0}),i)}}function makeDefinedBinder(t){return function(e,n,i,a,r){return e(autoCancelPrevious(function(e){return e?Function.noop:t(observeUndefined,n,i,a,r)}),i)}}function isActive(t){return t.getRangeChangeDescriptor&&t.getRangeChangeDescriptor().isActive}var Scope=require("./scope"),Observers=require("./observers"),autoCancelPrevious=Observers.autoCancelPrevious,once=Observers.once,observeRangeChange=Observers.observeRangeChange,cancelEach=Observers.cancelEach,makeNotObserver=Observers.makeNotObserver,makeOrObserver=Observers.makeOrObserver,makeAndObserver=Observers.makeAndObserver,observeValue=Observers.observeValue,observeUndefined=Observers.makeLiteralObserver(),trueScope=new Scope(!0),falseScope=new Scope(!1);exports.bindProperty=bindProperty;var _bindProperty=bindProperty;exports.makePropertyBinder=makePropertyBinder,exports.bindGet=bindGet;var _bindGet=bindGet;exports.makeGetBinder=makeGetBinder,exports.makeHasBinder=makeHasBinder,exports.makeEqualityBinder=makeEqualityBinder,exports.makeEveryBlockBinder=makeEveryBlockBinder,exports.makeAndBinder=makeAndBinder,exports.makeOrBinder=makeOrBinder,exports.makeConditionalBinder=makeConditionalBinder,exports.makeOnlyBinder=makeOnlyBinder,exports.makeRangeContentBinder=makeRangeContentBinder,exports.makeMapContentBinder=makeMapContentBinder,exports.makeReversedBinder=makeReversedBinder,exports.makeDefinedBinder=makeDefinedBinder;