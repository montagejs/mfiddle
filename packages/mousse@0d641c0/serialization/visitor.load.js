montageDefine("0d641c0","serialization/visitor",{dependencies:["collections/shim-object"],factory:function(t,e){(function(e){function n(t,e){this.builder=t,this.labeler=e,this._objectsSerialization=Object.create(null)}function i(t){var e=n.prototype.getCustomObjectTypeOf;return function(n){return t(n)||e(n)}}t("collections/shim-object"),Object.defineProperties(n.prototype,{builder:{value:null,writable:!0},labeler:{value:null,writable:!0},getTypeOf:{value:function(t){return this.isCustomObject(t)?"CustomObject":void 0}},getCustomObjectTypeOf:{value:function(){},writable:!0},isCustomObject:{value:function(t){var e=this.getCustomObjectTypeOf(t);return"string"==typeof e}},_objectsSerialization:{value:null,writable:!0},setObjectSerialization:{value:function(t,e){this._objectsSerialization[Object.hash(t)]=e}},getObjectSerialization:{value:function(t){return this._objectsSerialization[Object.hash(t)]}},isObjectSerialized:{value:function(t){return Object.hash(t)in this._objectsSerialization}},enterObject:{value:function(t,e){var n=this.builder.createObjectLiteral();this.setObjectSerialization(e,n),this.builder.push(n)}},exitObject:{value:function(t,e,n){this.storeValue(this.builder.pop(),e,n)}},visitObject:{value:function(t,e,n){var i=this.labeler.getObjectLabel(e),a=this.builder.createObjectReference(i);this.getObjectSerialization(e).setLabel(i),this.builder.top.setProperty(n,a)}},enterArray:{value:function(t,e){var n=this.builder.createArray();this.setObjectSerialization(e,n),this.builder.push(n)}},exitArray:{value:function(t,e,n){this.storeValue(this.builder.pop(),e,n)}},visitArray:{value:function(t,e,n){var i=this.labeler.getObjectLabel(e),a=this.builder.createObjectReference(i);this.getObjectSerialization(e).setLabel(i),this.builder.top.setProperty(n,a)}},visitRegExp:{value:function(t,e,n){this.storeValue(this.builder.createRegExp(e),e,n)}},visitString:{value:function(t,e,n){this.storeValue(this.builder.createString(e),e,n)}},visitNumber:{value:function(t,e,n){this.storeValue(this.builder.createNumber(e),e,n)}},visitBoolean:{value:function(t,e,n){this.storeValue(this.builder.createBoolean(e),e,n)}},visitNull:{value:function(t,e){this.storeValue(this.builder.createNull(),null,e)}},visitCustomObject:{value:function(t,e,n){var i=this.getCustomObjectTypeOf(e),r=a["visit"+i];if(i)return r.call(global,t,this,e,n);throw Error("Object's type is unknown: "+e)}},storeValue:{value:function(t,e,n){n===void 0?t.setLabel(this.labeler.getObjectLabel(e)):this.builder.top.setProperty(n,t)}}});var a=Object.create(null);n.addCustomObjectVisitor=function(t){for(var e in t)if("getTypeOf"!==e&&"function"==typeof t[e]&&/^visit/.test(e)){if(void 0!==a[e])return Error("Visitor '"+e+"' is already registered.");a[e]=t[e].bind(t)}this.prototype.getCustomObjectTypeOf=i(t.getTypeOf)},n.resetCustomObjectVisitors=function(){a=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},e.Visitor=n})(e)}});