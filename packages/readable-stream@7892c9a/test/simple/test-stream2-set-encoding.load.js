montageDefine("7892c9a","test/simple/test-stream2-set-encoding",{dependencies:["../common.js","assert","../../lib/_stream_readable","util"],factory:function(e){function t(e,t){l++,o.push([e,t])}function n(){var e=o.shift();if(!e)return console.error("ok");var t=e[0],i=e[1];console.log("# %s",t),i({same:r.deepEqual,equal:r.equal,end:function(){l--,n()}})}function i(e,t){a.call(this,t),this.pos=0,this.len=e||100}e("../common.js");var r=e("assert"),a=e("../../lib/_stream_readable"),s=e("util"),o=[],l=0;process.on("exit",function(){r.equal(l,0)}),process.nextTick(n),s.inherits(i,a),i.prototype._read=function(e){setTimeout(function(){if(this.pos>=this.len)return this.push(null);if(e=Math.min(e,this.len-this.pos),0>=e)return this.push(null);this.pos+=e;var t=new Buffer(e);return t.fill("a"),console.log("this.push(ret)",t),this.push(t)}.bind(this),1)},t("setEncoding utf8",function(e){var t=new i(100);t.setEncoding("utf8");var n=[],r=["aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa"];t.on("readable",function(){for(var e;null!==(e=t.read(10));)n.push(e)}),t.on("end",function(){e.same(n,r),e.end()}),t.emit("readable")}),t("setEncoding hex",function(e){var t=new i(100);t.setEncoding("hex");var n=[],r=["6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161"];t.on("readable",function(){for(var e;null!==(e=t.read(10));)n.push(e)}),t.on("end",function(){e.same(n,r),e.end()}),t.emit("readable")}),t("setEncoding hex with read(13)",function(e){var t=new i(100);t.setEncoding("hex");var n=[],r=["6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","16161"];t.on("readable",function(){console.log("readable once");for(var e;null!==(e=t.read(13));)n.push(e)}),t.on("end",function(){console.log("END"),e.same(n,r),e.end()}),t.emit("readable")}),t("encoding: utf8",function(e){var t=new i(100,{encoding:"utf8"}),n=[],r=["aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa"];t.on("readable",function(){for(var e;null!==(e=t.read(10));)n.push(e)}),t.on("end",function(){e.same(n,r),e.end()}),t.emit("readable")}),t("encoding: hex",function(e){var t=new i(100,{encoding:"hex"}),n=[],r=["6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161"];t.on("readable",function(){for(var e;null!==(e=t.read(10));)n.push(e)}),t.on("end",function(){e.same(n,r),e.end()}),t.emit("readable")}),t("encoding: hex with read(13)",function(e){var t=new i(100,{encoding:"hex"}),n=[],r=["6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","16161"];t.on("readable",function(){for(var e;null!==(e=t.read(13));)n.push(e)}),t.on("end",function(){e.same(n,r),e.end()}),t.emit("readable")})}});