var Component=require("montage/ui/component").Component,CodeMirror=require("./codemirror/codemirror-min").CodeMirror;exports.CodeMirror=Component.specialize({_codeMirror:{value:null},tabSize:{value:4},indentUnit:{value:4},matchBrackets:{value:!1},lineNumbers:{value:!1},readOnly:{value:!1},_newValue:{value:null},_mode:{value:null},mode:{set:function(e){this._mode=e,this._codeMirror&&("json"==e?this._codeMirror.setOption("mode",{name:"javascript",json:!0}):this._codeMirror.setOption("mode",e))},get:function(){return this._mode}},enterDocument:{value:function(e){var t,n;if(e){n="json"===this.mode?{name:"javascript",json:!0}:this.mode,t=this._codeMirror=CodeMirror(this._element,{mode:n,tabSize:this.tabSize,indentUnit:this.indentUnit,matchBrackets:this.matchBracket,lineNumbers:this.lineNumbers,readOnly:this.readOnly,value:this.value}),this._newValue=null;var i=this.element,o=this.ownerComponent.element.parentElement;setTimeout(function a(){getComputedStyle(i).width===getComputedStyle(o).width?setTimeout(a,50):t.refresh()},0)}}},draw:{value:function(){null!=this._newValue&&(this._codeMirror.setValue(this._newValue),this._newValue=null)}},value:{get:function(){return this._codeMirror?null!=this._newValue?this._newValue:this._codeMirror.getValue():this._newValue},set:function(e){this._newValue=e,this.needsDraw=!0}},hasModeErrors:{value:function(){return!!this._element.querySelector("*[class~='cm-error']")}}});