montageDefine("0d641c0","deserialization/reviver",{dependencies:["q"],factory:function(t,e){(function(e){function n(){}function i(t){var e=n.prototype.getCustomObjectTypeOf;return function(n){return t(n)||e(n)}}var a=function(){return this}(),r=t("q");Object.defineProperties(n.prototype,{_createAssignValueFunction:{value:function(t,e){return function(n){t[e]=n}}},getTypeOf:{value:function(t){var e=typeof t;return null===t?"null":Array.isArray(t)?"array":"object"===e&&1===Object.keys(t).length?"@"in t?"reference":"/"in t?"regexp":"object":e}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(t,e,n){var i;return t.debugger,"value"in t?e.hasUserObject(n)?(i=e.getUserObject(n),e.setObjectLabel(i,n),i):this.reviveValue(t.value,e,n):0===Object.keys(t).length?e.hasUserObject(n)?(i=e.getUserObject(n),e.setObjectLabel(i,n),i):this.reviveExternalObject(t,e,n):this.reviveCustomObject(t,e,n)}},reviveValue:{value:function(t,e,n){var i=this.getTypeOf(t);return"string"===i||"number"===i||"boolean"===i||"null"===i||"undefined"===i?this.reviveNativeValue(t,e,n):"regexp"===i?this.reviveRegExp(t,e,n):"reference"===i?this.reviveObjectReference(t,e,n):"array"===i?this.reviveArray(t,e,n):"object"===i?this.reviveObjectLiteral(t,e,n):this._callReviveMethod("revive"+i,t,e,n)}},reviveNativeValue:{value:function(t,e,n){return n&&e.setObjectLabel(t,n),t}},reviveObjectLiteral:{value:function(t,e,n){var i,a=[];n&&e.setObjectLabel(t,n);for(var s in t)i=this.reviveValue(t[s],e),r.isPromise(i)?a.push(i.then(this._createAssignValueFunction(t,s))):t[s]=i;return 0===a.length?t:r.all(a).then(function(){return t})}},reviveRegExp:{value:function(t,e,n){var t=t["/"],i=RegExp(t.source,t.flags);return n&&e.setObjectLabel(i,n),i}},reviveObjectReference:{value:function(t,e){var t=t["@"],n=e.getObject(t);return n}},reviveArray:{value:function(t,e,n){var i,a=[];n&&e.setObjectLabel(t,n);for(var s=0,o=t.length;o>s;s++)i=this.reviveValue(t[s],e),r.isPromise(i)?a.push(i.then(this._createAssignValueFunction(t,s))):t[s]=i;return 0===a.length?t:r.all(a).then(function(){return t})}},reviveCustomObject:{value:function(t,e,n){var i=this.getCustomObjectTypeOf(t),o=s["revive"+i];return i?o.call(a,t,e,n):r.reject(Error("Object's type is unknown: "+JSON.stringify(t)))}},reviveExternalObject:{value:function(t,e,n){return r.reject(Error("External object '"+n+"' not found in user objects."))}},_callReviveMethod:{value:function(t,e,n,i){return this[t](e,n,i)}}});var s=Object.create(null);n.addCustomObjectReviver=function(t){for(var e in t)if("getTypeOf"!==e&&"function"==typeof t[e]&&/^revive/.test(e)){if(void 0!==s[e])return Error("Reviver '"+e+"' is already registered.");s[e]=t[e].bind(t)}this.prototype.getCustomObjectTypeOf=i(t.getTypeOf)},n.resetCustomObjectRevivers=function(){s=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},e.Reviver=n})(e),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)})}});