montageDefine("bf08a23","listen/map-changes",{dependencies:["weak-map","../list","../dict"],factory:function(t,e,n){"use strict";function i(){throw Error("Can't construct. MapChanges is a mixin.")}var a=t("weak-map"),r=t("../list");n.exports=i,Object.prototype.hasOwnProperty;var s=new a;i.prototype.getAllMapChangeDescriptors=function(){var e=t("../dict");return s.has(this)||s.set(this,e()),s.get(this)},i.prototype.getMapChangeDescriptor=function(t){var e=this.getAllMapChangeDescriptors();return t=t||"",e.has(t)||e.set(t,{willChangeListeners:new r,changeListeners:new r}),e.get(t)},i.prototype.addMapChangeListener=function(t,e,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var i,a=this.getMapChangeDescriptor(e);i=n?a.willChangeListeners:a.changeListeners,i.push(t),this.dispatchesMapChanges=!0;var r=this;return function(){r&&(r.removeMapChangeListener(t,e,n),r=null)}},i.prototype.removeMapChangeListener=function(t,e,n){var i,a=this.getMapChangeDescriptor(e);i=n?a.willChangeListeners:a.changeListeners;var r=i.findLast(t);if(!r)throw Error("Can't remove listener: does not exist.");r["delete"]()},i.prototype.dispatchMapChange=function(t,e,n){var i=this.getAllMapChangeDescriptors(),a="Map"+(n?"WillChange":"Change");i.forEach(function(i,r){if(!i.isActive){i.isActive=!0;var s;s=n?i.willChangeListeners:i.changeListeners;var o="handle"+(r.slice(0,1).toUpperCase()+r.slice(1))+a;try{s.forEach(function(n){if(n[o])n[o](e,t,this);else{if(!n.call)throw Error("Handler "+n+" has no method "+o+" and is not callable");n.call(n,e,t,this)}},this)}finally{i.isActive=!1}}},this)},i.prototype.addBeforeMapChangeListener=function(t,e){return this.addMapChangeListener(t,e,!0)},i.prototype.removeBeforeMapChangeListener=function(t,e){return this.removeMapChangeListener(t,e,!0)},i.prototype.dispatchBeforeMapChange=function(t,e){return this.dispatchMapChange(t,e,!0)}}});